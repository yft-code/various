(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c8d9d"],{5749:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t._self._c;return e("div",[e("el-button",{on:{click:t.createApp}},[t._v("开始启动")]),e("el-button",{on:{click:t.getHistory}},[t._v("获取历史记录")]),e("el-button",{on:{click:t.uploadDown}},[t._v("下载")]),e("span",[t._v("下载句柄:")]),e("input",{attrs:{type:"text",id:"downloadHandle",value:""}}),e("div",{on:{click:t.getUploadMeg}},[t._v("获取下载信息")]),e("div",{staticClass:"info"}),e("div",{staticClass:"video",staticStyle:{height:"0",width:"0"},attrs:{id:"video"}})],1)},i=[],r=n("1157"),d=n.n(r);const a="http://127.0.0.1:58088";let s=!1,c="ws://127.0.0.1:58089",l=null,w=null,p=0,u=!1,h={},f={versionObj:function(){return{currentVersion:"1.3.0",mustVersion:"1.0.0",recommandVersion:"1.1.0"}},createApplication:function(){return new Promise(t=>{b(a,e=>(console.log("resssss",e),t(e)))}).then(t=>(0===t.errorCode&&(v(),t["application"]=g(t.body.appId)),t))},exitApplication:function(t){let e={name:"/v1/exit-application",url:a+"/v1/exit-application",data:{appId:t}};return new Promise(t=>{T(e,(function(e){return t(e)}))}).then(t=>t)},getApplication:function(t){return v(),g(t)}};function g(t){return{appId:t,createWindow:function(t){t["appId"]=this.appId;let e={name:"/v1/create-window",url:a+"/v1/create-window",data:t};return I(e)},showWindow:function(t){const e={windowId:t,appId:this.appId};let n={name:"/v1/show-window",url:a+"/v1/show-window",data:e};return new Promise(t=>{T(n,(function(e){return t(e)}))}).then(e=>(0===e.errorCode&&this.windowIdList.forEach(e=>{e["windowId"]===t&&(e["showWindow"]=!0)}),e))},hideWindow:function(t){let e={name:"/v1/hide-window",url:a+"/v1/hide-window",data:{windowId:t,appId:this.appId}};return new Promise(t=>{T(e,(function(e){return t(e)}))}).then(e=>(0===e.errorCode&&this.windowIdList.forEach(e=>{e["windowId"]===t&&(e["showWindow"]=!1)}),e))},closeWindow:function(t){let e={name:"/v1/close-window",url:a+"/v1/close-window",data:{windowId:t,appId:this.appId}};return new Promise(t=>{T(e,(function(e){return t(e)}))}).then(e=>(0===e.errorCode&&(this.windowIdList=this.windowIdList.filter(e=>e.windowId!=t)),e))},setWindowRect:function(t){t["appId"]=this.appId;let e={name:"/v1/set-window-rect",url:a+"/v1/set-window-rect",data:t};return I(e)},exitApplication:function(){let e={name:"/v1/exit-application",url:a+"/v1/exit-application",data:{appId:t}};return I(e)},setWindowTop:function(t,e){let n={name:"/v1/set-window-top",url:a+"/v1/set-window-top",data:{windowId:t,isTop:e,appId:this.appId}};return I(n)},windowIdList:[],bindWindow:function(t,e){const n=this.windowIdList.filter(t=>t.windowId===e).length;0===n&&this.windowIdList.push({windowId:e,locationInfo:this.getLocationInfo(t),id:t,showWindow:!1}),this.updataWindow()},updataWindow:function(){let t=!0,e=setInterval(()=>{0===this.windowIdList.length&&clearInterval(e),this.windowIdList.forEach(e=>{const n=e["locationInfo"].height-this.getLocationInfo(e["id"]).height;if(d()(window).on("resize",()=>{t=!1}),t&&JSON.stringify(e["locationInfo"])!==JSON.stringify(this.getLocationInfo(e["id"]))&&e["showWindow"]&&1!==n){const t=this.getLocationInfo(e["id"]),n={windowId:e["windowId"],left:t.left,top:t.top,width:t.width,height:t.height,title:document.title};this.setWindowRect(n),e["locationInfo"]=this.getLocationInfo(e["id"])}t=!0})},80)},getLocationInfo:function(t){const e=document.getElementById(t);var n=navigator.userAgent;if(/firefox/i.test(n)){const t=screen.availHeight===outerHeight||outerHeight===innerHeight?0:outerHeight>innerHeight?-8:8;return{left:Math.floor(screenX+e.getBoundingClientRect().left*W()),top:Math.floor(screenY+(outerHeight-innerHeight*W())+e.getBoundingClientRect().top*W()+t),width:Math.floor(e.getBoundingClientRect().width*W()),height:Math.floor(e.getBoundingClientRect().height*W()),screenLeft:Math.floor(window.screenLeft)}}return{left:Math.floor(e.getBoundingClientRect().left*W()),top:Math.floor(e.getBoundingClientRect().top*W()),width:Math.floor(e.getBoundingClientRect().width*W()),height:Math.floor(e.getBoundingClientRect().height*W()),screenLeft:Math.floor(window.screenLeft)}},sendAction:function(t,e,n){let o={name:"/v1/send-action-to-window",url:a+"/v1/send-action-to-window",data:{windowId:t,command:e,args:n}};return I(o)},checkUpgrade:function(){let t={name:"/v1/check-upgrade",url:a+"/v1/check-upgrade"};return I(t)},cutPartWindow:function(t,e,n,o,i){let r={name:"/v1/cut-part-window",url:a+"/v1/cut-part-window",data:{windowId:t,left:e,top:n,width:o,height:i}};return I(r)},repairPartWindow:function(t,e,n,o,i){let r={name:"/v1/repair-part-window",url:a+"/v1/repair-part-window",data:{windowId:t,left:e,top:n,width:o,height:i}};return I(r)},setCallback:function(t,e,n){let o={name:"/v1/set-callback",url:a+"/v1/set-callback",data:{windowId:t,evt:e,callbackFunc:n}};return I(o)},setWindowWaterMask:function(t){let e={name:"/v1/set-window-watermask",url:a+"/v1/set-window-watermask",data:{waterInfo:t}};return I(e)},setWindowStyle:function(t){let e={name:"/v1/set-window-style",url:a+"/v1/create-window",data:t};return I(e)}}}function I(t){return new Promise(e=>{T(t,(function(t){return e(t)}))}).then(t=>t)}function v(){try{"WebSocket"in window?(l=new WebSocket(c),m()):alert("当前浏览器 Not support websocket")}catch(t){console.log("catch")}}function m(){l.onerror=function(){console.log("socket连接失败"),s=!1,y(c)},l.onopen=function(){console.log("socket连接已打开"),p=0,s=!0},l.onmessage=function(t){console.log("返回值1111:",JSON.parse(t.data));const e=JSON.parse(t.data),n=e.name;"EVENT_SNAPSHOT_CLICK"===n?console.log("抓拍事件返回：",e.body):"EVENT_CUSTOM_MENU"===n?console.log("点击按钮名称：",e.body.menuName):"EVENT_OPERATE_PANE"===n?console.log("窗格操作事件返回：",e.body):"EVENT_STREAM_INFO"===n?console.log("媒体信息通知事件返回：",e.body):"EVENT_PLAY_STATE"===n?console.log("播放状态变更事件返回：",e.body):h[n](e)},l.onclose=function(){console.log("socket连接已关闭"),s=!1,y(c)}}function y(t){s||u||(w&&clearTimeout(w),w=setTimeout((function(){p>2?(clearTimeout(w),s=!0,alert("WebSocket重连失败")):(v(t),s=!1,p++)}),500))}function T(t,e){const n=t.name;console.log("发送消息",t),h[n]=e,1===l.readyState&&l.send(JSON.stringify(t))}function b(t,e){const n={method:"GET",url:t,success:t=>{e&&e(t)},error:t=>{t=JSON.stringify(t),t.indexOf("error")>-1&&window.alert("未安装MP_Web_Plugin插件，请先安装插件！")}};d.a.ajax(n)}function W(){var t=0,e=window.screen,n=navigator.userAgent.toLowerCase();return void 0!==window.devicePixelRatio?t=window.devicePixelRatio:~n.indexOf("msie")?e.deviceXDPI&&e.logicalXDPI&&(t=e.deviceXDPI/e.logicalXDPI):void 0!==window.outerWidth&&void 0!==window.innerWidth&&(t=window.outerWidth/window.innerWidth),t}var L={data(){return{windowType:"",timer:"",application:{},appInfo:{appId:null,curWinId:null,videoList:[]}}},methods:{getUploadMeg(){const t={downloadHandle:d()("#downloadHandle").val()};d()(".info").empty(),this.application.sendAction(this.appInfo.curWinId,"GET_DOWNLOAD_INFO",t).then(t=>{t.errorCode;let e=0===t.body.status?"暂停":"下载";d()(".info").append(`\n        <div>下载状态：${e}；</div>\n        <div>下载速度：${t.body.speed}KB/S；</div>\n        <div>下载大小：${t.body.downloadSize}KB；</div>\n        <div>剩余下载时间：${t.body.timeLeft}s；</div>\n        <div>当前下载进度：${t.body.progress}%；</div>\n        <div>已下载时间：${t.body.recordTime}s；</div>`),console.log("res.body",JSON.stringify(t.body))})},getHistory(){console.log("获取历史记录零零零零"),this.showVideo("REPLAY_PURE")},one(){},transVersion(t){return Number(t.split(".").join(""))},createApp(){let t;f.createApplication().then(e=>{if(0===e.errorCode){this.application=e.application,console.log("application初始化",this.application),this.appInfo.appId=e.body.appId,sessionStorage.setItem("appId",this.appInfo.appId),t=f.versionObj();let n=setTimeout(()=>{d()(".startApp").hide(),d()(".videoPanel").show(),this.application.checkUpgrade().then(e=>{0!==e.errorCode&&alert(e.errorMsg);const n=e.body.pluginVersion.substring(12,17);this.transVersion(n)<this.transVersion(t.currentVersion)&&(this.transVersion(n)<=this.transVersion(t.mustVersion)&&alert("当前插件版本过旧，请关闭浏览器升级插件，以免影响正常使用"),this.transVersion(n)<=this.transVersion(t.recommandVersion)&&this.transVersion(n)>this.transVersion(t.mustVersion)&&alert("当前插件版本较低，推荐关闭浏览器升级到最新版本"),this.transVersion(n)>this.transVersion(t.recommandVersion)&&alert("当前插件有新版本，可关闭浏览器升级到最新版本"))}),setTimeout(()=>{this.getHistory()}),clearTimeout(n)},1500)}else alert(e.errorMsg)})},showVideo(t){this.windowType=t;const e={pluginType:t,rect:{left:-1e3,top:-1e3,width:0,height:0},title:document.title};console.log(" windowInfo",e),this.application.createWindow(e).then(e=>{if(0===e.errorCode){this.appInfo.videoList.push({type:t,windowId:e.body.windowId,layout:"11",broadCast:"",fileBroadCast:"",tabIndex:0,ratioMode:"FULL",playType:"0"}),this.appInfo.curWinId=e.body.windowId,sessionStorage.setItem("curWinId",this.appInfo.curWinId),sessionStorage.setItem("videoList",JSON.stringify(this.appInfo.videoList));this.application.getLocationInfo("video")}else alert(e.errorMsg)})},uploadDown(){const t={url:"rtsp://117.174.152.90:33554/00054381710408220101?DstCode=01&ServiceType=3&ClientType=0&StreamID=1&SrcTP=2&DstTP=2&SrcPP=1&DstPP=1&MediaTransMode=0&BroadcastType=0&SV=1&TimeSpan=20220927T000000Z-20220927T010000Z&Token=CTkPlzfzWSlB+66JoyxooKezRFw6JiyRPqQvi+YsR0k=&ExNat=1&",playType:"0",namePrefix:"1111",speed:"",timeSpan:{BeginTime:"20220927000000",EndTime:"20220927010000"}};console.log("xxxxxxargs",t),this.application.sendAction(this.appInfo.curWinId,"START_DOWNLOAD",t).then(t=>{t.errorCode,console.log("下载句柄："+t.body.downloadHandle)})}}},S=L,P=n("2877"),C=Object(P["a"])(S,o,i,!1,null,null,null);e["default"]=C.exports}}]);
//# sourceMappingURL=chunk-2d0c8d9d.03b8c6fd.js.map